# Proportions Wet

**NOTE**: using wets > 0 after averaging will not capture the underlying switches in the 10-minute data, once we bin this data we lose access to those switch points. This is why we calculated switches before down sampling. Proportions can be calculated in 2hr bins because looking at the 10min bins is way too high of a resolution.

Calculate proportions for downsampled data where the sum of wets was calculated in 2hr bins
Should be sum for calculating proportions, and not mean wets.

##Load settings

```{r include=FALSE}
source(here::here("project_settings.R"), echo=TRUE)
```


## Calclate Proportions
 
Function to calculate proportion of wet time on the downsampled data:
```{r}

calc_prop <- function(deg_data, bin_time = bin_time) {
  
  bird_id <- deg_data$bird_id[1]
  
  #start by calculating metrics for a single 2hr bin
  prop_data <- deg_data %>%
    mutate(
      bird_id = bird_id,
      #proportion of time wet in bin_time period (wets*30 converts wetness level into secs spent wet)
      # (600sec per 10min interval) / 20 = 30 seconds per unit 
      prop_wet = (wets * 30) / (bin_time * 3600) #convert wets to secs and divide by bin_length in secs
      )

  return(prop_data)
}
```


Applying the function to our DEG files downsampled by 2hrs using sum of wets:

```{r}
plan(multisession, workers = 4)

bin_time = 2

deg_props_2hrs <- future_map_dfr(deg_2hrs, calc_prop, bin_time = bin_time)

deg_props_2hrs

```
